var app={};!function(){"use strict";var a=function(a){return 0>a&&(a=360+a),8*(a-150)};$("#scope").show(),window.addEventListener("deviceorientation",function(b){var c=app.degree=b.beta,d=$("#scope");d.css("top",a(c))},!1);var b=app.Satellite=function(){this.$satellite=$("#satellite")};b.prototype.start=function(a){var b=this.$satellite;b.show();var c=0,d=setInterval(function(){c-=20,b.css("top",c),b.height()+c<0&&(clearInterval(d),b.hide(),a&&a())},100)},b.prototype.flight=function(){var a=this.$satellite,b=150,c=this;a.show();var d=setInterval(function(){c.degree=b,c.offset=b-app.degree,c.isChance()?$("#take").addClass("btn-primary"):$("#take").removeClass("btn-primary");var e=700-12*(b-app.degree);c.top=e,console.log("chance: "+c.isChance()+", offset: "+c.offset+", degree: "+b+", top: "+e),a.css("top",e),b++,(60>b||b>300)&&(clearInterval(d),a.hide())},100)},b.prototype.isChance=function(){var a=function(a){var b=a.offset();return{top:b.top,bottom:b.top+a.height()}},b=a(this.$satellite),c=a($("#scope"));return console.log("satellite: "+b),console.log("scope: "+c),b.top<=c.bottom&&b.bottom>=c.top};var c=app.Map=function(){this.$map=$("#map");var a={center:new google.maps.LatLng(-34.397,150.644),zoom:16,disableDefaultUI:!0,mapTypeId:google.maps.MapTypeId.SATELLITE};this.map=new google.maps.Map(document.getElementById("map"),a);var b=this;navigator.geolocation.watchPosition(function(a){console.log(a.coords.latitude),console.log(a.coords.longitude),b.setCenter(a.coords)})};c.prototype.setCenter=function(a){this.map.setCenter(new google.maps.LatLng(a.latitude,a.longitude))},c.prototype.setSize=function(a,b){this.$map.width(a),this.$map.height(b)},c.prototype.show=function(){this.$map.css("zIndex",7)},c.prototype.hide=function(){this.$map.css("zIndex",0)},navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetuserMedia;var d=app.Camera=function(){this.$finder=$("#finder")};d.prototype.initialize=function(){var a=this.$finder;navigator.getUserMedia({video:!0},function(b){console.log("VIDEO"),a.attr("src",window.URL.createObjectURL(b)),setTimeout(function(){a[0].play()})},function(){}),this.map=new c},d.prototype.show=function(){this.$finder.show()},d.prototype.hide=function(){this.$finder.hide()},d.prototype.takePicture=function(){var a=$("#picture"),b=$("#finder"),c=a[0].getContext("2d");console.log(b[0].videoWidth),console.log(b[0].videoHeight),a[0].width=b[0].videoWidth,a[0].height=b[0].videoHeight,c.drawImage(this.$finder[0],0,0)},d.prototype.takeMap=function(){this.map.show()};var e=app.App=function(){$("#take").hide(),this.camera=new d,this.camera.initialize(),this.satellite=new b,this.camera.show()};e.prototype.take=function(){$("#shutter-sound")[0].play(),$("#take").hide(),$("#finder").hide(),this.satellite.isChance()?this.camera.takeMap():this.camera.takePicture()},e.prototype.start=function(){$("#take").show(),$("#satellite-start").hide();var a=this.satellite;a.start(function(){a.flight()})}}(),$(document).ready(function(){"use strict";var a=new app.App;$("#take").on("click",function(){a.take()}),$("#satellite-start").on("click",function(){a.start()})});